<div class="p-4 sm:p-6 lg:p-8" x-data="{
        activeTab: 'dokumen',
        init() {
            // Check for tab in URL hash
            if (window.location.hash) {
                const hash = window.location.hash.substring(1);
                if (['dokumen', 'temuan', 'tindak-lanjut'].includes(hash)) {
                    this.activeTab = hash;
                }
            }
            
            // Update URL when tab changes
            this.$watch('activeTab', (value) => {
                window.location.hash = value;
            });
            
            // Listen for Livewire events
            window.addEventListener('show-tindak-lanjut-modal', () => {
                this.$refs.tindakLanjutModal.show = true;
            });
        },
        changeTab(tab) {
            this.activeTab = tab;
            // Smooth scroll to top of tab content
            this.$refs.tabContent.scrollIntoView({ behavior: 'smooth' });
        }
    }">
    @if (session()->has('message'))
        <div x-data="{ show: true }" 
             x-show="show" 
             x-init="setTimeout(() => show = false, 3000)" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform translate-y-2"
             x-transition:enter-end="opacity-100 transform translate-y-0"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100 transform translate-y-0"
             x-transition:leave-end="opacity-0 transform -translate-y-2"
             class="mb-6 rounded-lg bg-green-50 p-4 shadow-sm border border-green-100">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-check-circle text-green-500"></i>
                </div>
                <div class="ml-3">
                    <p class="text-sm font-medium text-green-800">{{ session('message') }}</p>
                </div>
            </div>
        </div>
    @endif

    <!-- Header -->
    <div class="mb-8">
        <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold text-gray-900">{{ $lhp->judul_lhp }}</h1>
                <div class="mt-2 flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-gray-600">
                    <span class="flex items-center">
                        <i class="fas fa-hashtag text-blue-500 mr-1.5"></i>
                        {{ $lhp->nomor_lhp }}
                    </span>
                    <span class="flex items-center">
                        <i class="far fa-calendar-alt text-blue-500 mr-1.5"></i>
                        {{ $lhp->tanggal_lhp->translatedFormat('d F Y') }}
                    </span>
                </div>
            </div>
            <div class="flex-shrink-0">
                <a href="{{ route('lhps') }}" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200">
                    <i class="fas fa-arrow-left mr-2"></i>
                    Kembali ke Daftar LHP
                </a>
            </div>
        </div>
    </div>

    <!-- Tabs Navigation -->
    <div class="border-b border-gray-200 mb-8">
        <nav class="-mb-px flex space-x-8 overflow-x-auto" aria-label="Tabs">
            <button 
                @click="changeTab('dokumen')"
                :class="{
                    'border-blue-500 text-blue-600': activeTab === 'dokumen',
                    'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': activeTab !== 'dokumen',
                    'transition-all duration-200': true
                }"
                class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm focus:outline-none group relative"
            >
                <div class="flex items-center">
                    <i class="fas fa-file-alt mr-2"></i>
                    <span>Dokumen LHP</span>
                </div>
                <span x-show="activeTab === 'dokumen'" class="absolute bottom-0 left-0 w-full h-0.5 bg-blue-500"></span>
            </button>

            <button 
                @click="changeTab('temuan')"
                :class="{
                    'border-blue-500 text-blue-600': activeTab === 'temuan',
                    'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': activeTab !== 'temuan',
                    'transition-all duration-200': true
                }"
                class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm focus:outline-none group relative"
            >
                <div class="flex items-center">
                    <i class="fas fa-clipboard-list mr-2"></i>
                    <span>Temuan & Rekomendasi</span>
                </div>
                <span x-show="activeTab === 'temuan'" class="absolute bottom-0 left-0 w-full h-0.5 bg-blue-500"></span>
            </button>

            <button 
                @click="changeTab('tindak-lanjut')"
                :class="{
                    'border-blue-500 text-blue-600': activeTab === 'tindak-lanjut',
                    'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': activeTab !== 'tindak-lanjut',
                    'transition-all duration-200': true
                }"
                class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm focus:outline-none group relative"
            >
                <div class="flex items-center">
                    <i class="fas fa-tasks mr-2"></i>
                    <span>Tindak Lanjut</span>
                    @if($lhp->tindakLanjuts->count() > 0)
                        <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            {{ $lhp->tindakLanjuts->count() }}
                        </span>
                    @endif
                </div>
                <span x-show="activeTab === 'tindak-lanjut'" class="absolute bottom-0 left-0 w-full h-0.5 bg-blue-500"></span>
            </button>
        </nav>
    </div>

    <!-- Tab Content -->
    <div x-ref="tabContent">
        <!-- Dokumen LHP Tab -->
        <div x-show="activeTab === 'dokumen'" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0">
            <form wire:submit.prevent="save">
                <div class="bg-white shadow overflow-hidden sm:rounded-lg mb-8 transform transition-all duration-300 hover:shadow-md">
                    <div class="px-4 py-5 sm:px-6 bg-gradient-to-r from-blue-50 to-blue-100 border-b border-blue-200">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-blue-100 p-2 rounded-lg">
                                <i class="fas fa-file-alt text-blue-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-medium leading-6 text-gray-900">Dokumen LHP</h3>
                                <p class="mt-1 max-w-2xl text-sm text-gray-600">Kelola seluruh dokumen terkait LHP</p>
                            </div>
                        </div>
                    </div>
            <div class="border-t border-gray-200 px-4 py-5 sm:p-0">
                <dl class="sm:divide-y sm:divide-gray-200">
                    <!-- File Surat Tugas -->
                    <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                        <dt class="text-sm font-medium text-gray-500">File Surat Tugas</dt>
                        <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">
                            @if($lhp->file_surat_tugas)
                                <div class="flex items-center">
                                    <a href="{{ Storage::url($lhp->file_surat_tugas) }}" target="_blank" class="text-blue-600 hover:text-blue-800">
                                        <i class="fas fa-file-pdf mr-2"></i>Lihat File
                                    </a>
                                    <button type="button" wire:click="deleteFile('file_surat_tugas')" class="ml-4 text-red-600 hover:text-red-800">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            @else
                                <div class="space-y-2">
                                    <input type="file" wire:model="file_surat_tugas" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                                    @error('file_surat_tugas') <span class="text-red-500 text-xs">{{ $message }}</span> @enderror
                                    
                                    <div class="upload-progress hidden space-y-1 mt-2" 
                                         x-data="{ 
                                            progress: 0, 
                                            speed: 0, 
                                            timeRemaining: 'Menghitung...', 
                                            uploaded: 0, 
                                            total: 0,
                                            formatFileSize(bytes) {
                                                if (!bytes || bytes === 0) return '0 Bytes';
                                                const k = 1024;
                                                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                                                const i = Math.floor(Math.log(bytes) / Math.log(k));
                                                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                                            }
                                         }" 
                                         x-init="
                                            $watch('progress', value => {
                                                const progressBar = $el.querySelector('.progress-bar');
                                                if (progressBar) {
                                                    progressBar.style.width = value + '%';
                                                    progressBar.classList.toggle('bg-blue-600', value < 100);
                                                    progressBar.classList.toggle('bg-green-500', value === 100);
                                                }
                                            });
                                            
                                            // Listen for progress updates
                                            window.addEventListener('upload-progress-updated', (e) => {
                                                if (e.detail.name === 'file_surat_tugas') {
                                                    progress = e.detail.progress;
                                                    const fileInput = $el.closest('dd').querySelector('input[type=file]');
                                                    if (fileInput && fileInput.files[0]) {
                                                        uploaded = fileInput.files[0].size * (progress / 100);
                                                        total = fileInput.files[0].size;
                                                    }
                                                }
                                            });
                                         ">
                                        <div class="flex justify-between text-xs text-gray-600">
                                            <span class="font-medium">Mengunggah...</span>
                                            <span x-text="timeRemaining"></span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
                                            <div class="bg-blue-600 h-2 rounded-full progress-bar transition-all duration-300 ease-in-out" 
                                                 :class="{ 'animate-pulse': progress < 100 }">
                                            </div>
                                        </div>
                                        <div class="flex justify-between text-xs text-gray-500">
                                            <span x-text="formatFileSize(uploaded) + ' / ' + formatFileSize(total)"></span>
                                            <span x-text="(progress || 0).toFixed(1) + '%'"></span>
                                        </div>
                                    </div>
                                </div>
                            @endif
                        </dd>
                    </div>
                    
                    <!-- File LHP -->
                    <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                        <dt class="text-sm font-medium text-gray-500">File LHP</dt>
                        <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">
                            @if($lhp->file_lhp)
                                <div class="flex items-center">
                                    <a href="{{ Storage::url($lhp->file_lhp) }}" target="_blank" class="text-blue-600 hover:text-blue-800">
                                        <i class="fas fa-file-pdf mr-2"></i>Lihat File
                                    </a>
                                    <button type="button" wire:click="deleteFile('file_lhp')" class="ml-4 text-red-600 hover:text-red-800">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            @else
                                <div class="space-y-2">
                                    <input type="file" wire:model="file_lhp" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                                    @error('file_lhp') <span class="text-red-500 text-xs">{{ $message }}</span> @enderror
                                    
                                    <div class="upload-progress hidden space-y-1 mt-2" 
                                         x-data="{ 
                                            progress: 0, 
                                            speed: 0, 
                                            timeRemaining: 'Menghitung...', 
                                            uploaded: 0, 
                                            total: 0,
                                            formatFileSize(bytes) {
                                                if (!bytes || bytes === 0) return '0 Bytes';
                                                const k = 1024;
                                                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                                                const i = Math.floor(Math.log(bytes) / Math.log(k));
                                                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                                            }
                                         }" 
                                         x-init="
                                            $watch('progress', value => {
                                                const progressBar = $el.querySelector('.progress-bar');
                                                if (progressBar) {
                                                    progressBar.style.width = value + '%';
                                                    progressBar.classList.toggle('bg-blue-600', value < 100);
                                                    progressBar.classList.toggle('bg-green-500', value === 100);
                                                }
                                            });
                                            
                                            // Listen for progress updates
                                            window.addEventListener('upload-progress-updated', (e) => {
                                                if (e.detail.name === 'file_lhp') {
                                                    progress = e.detail.progress;
                                                    const fileInput = $el.closest('dd').querySelector('input[type=file]');
                                                    if (fileInput && fileInput.files[0]) {
                                                        uploaded = fileInput.files[0].size * (progress / 100);
                                                        total = fileInput.files[0].size;
                                                    }
                                                }
                                            });
                                         ">
                                        <div class="flex justify-between text-xs text-gray-600">
                                            <span class="font-medium">Mengunggah...</span>
                                            <span x-text="timeRemaining"></span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
                                            <div class="bg-blue-600 h-2 rounded-full progress-bar transition-all duration-300 ease-in-out" 
                                                 :class="{ 'animate-pulse': progress < 100 }">
                                            </div>
                                        </div>
                                        <div class="flex justify-between text-xs text-gray-500">
                                            <span x-text="formatFileSize(uploaded) + ' / ' + formatFileSize(total)"></span>
                                            <span x-text="(progress || 0).toFixed(1) + '%'"></span>
                                        </div>
                                    </div>
                                </div>
                            @endif
                        </dd>
                    </div>
                    
                    <!-- File Kertas Kerja -->
                    <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                        <dt class="text-sm font-medium text-gray-500">File Kertas Kerja</dt>
                        <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">
                            @if($lhp->file_kertas_kerja)
                                <div class="flex items-center">
                                    <a href="{{ Storage::url($lhp->file_kertas_kerja) }}" target="_blank" class="text-blue-600 hover:text-blue-800">
                                        <i class="fas fa-file-pdf mr-2"></i>Lihat File
                                    </a>
                                    <button type="button" wire:click="deleteFile('file_kertas_kerja')" class="ml-4 text-red-600 hover:text-red-800">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            @else
                                <div class="space-y-2">
                                    <input type="file" wire:model="file_kertas_kerja" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                                    @error('file_kertas_kerja') <span class="text-red-500 text-xs">{{ $message }}</span> @enderror
                                    
                                    <div class="upload-progress hidden space-y-1 mt-2" 
                                         x-data="{ 
                                            progress: 0, 
                                            speed: 0, 
                                            timeRemaining: 'Menghitung...', 
                                            uploaded: 0, 
                                            total: 0,
                                            formatFileSize(bytes) {
                                                if (!bytes || bytes === 0) return '0 Bytes';
                                                const k = 1024;
                                                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                                                const i = Math.floor(Math.log(bytes) / Math.log(k));
                                                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                                            }
                                         }" 
                                         x-init="
                                            $watch('progress', value => {
                                                const progressBar = $el.querySelector('.progress-bar');
                                                if (progressBar) {
                                                    progressBar.style.width = value + '%';
                                                    progressBar.classList.toggle('bg-blue-600', value < 100);
                                                    progressBar.classList.toggle('bg-green-500', value === 100);
                                                }
                                            });
                                            
                                            // Listen for progress updates
                                            window.addEventListener('upload-progress-updated', (e) => {
                                                if (e.detail.name === 'file_kertas_kerja') {
                                                    progress = e.detail.progress;
                                                    const fileInput = $el.closest('dd').querySelector('input[type=file]');
                                                    if (fileInput && fileInput.files[0]) {
                                                        uploaded = fileInput.files[0].size * (progress / 100);
                                                        total = fileInput.files[0].size;
                                                    }
                                                }
                                            });
                                         ">
                                        <div class="flex justify-between text-xs text-gray-600">
                                            <span class="font-medium">Mengunggah...</span>
                                            <span x-text="timeRemaining"></span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
                                            <div class="bg-blue-600 h-2 rounded-full progress-bar transition-all duration-300 ease-in-out" 
                                                 :class="{ 'animate-pulse': progress < 100 }">
                                            </div>
                                        </div>
                                        <div class="flex justify-between text-xs text-gray-500">
                                            <span x-text="formatFileSize(uploaded) + ' / ' + formatFileSize(total)"></span>
                                            <span x-text="(progress || 0).toFixed(1) + '%'"></span>
                                        </div>
                                    </div>
                                </div>
                            @endif
                        </dd>
                    </div>
                    
                    <!-- File Review Sheet -->
                    <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                        <dt class="text-sm font-medium text-gray-500">File Review Sheet</dt>
                        <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">
                            @if($lhp->file_review_sheet)
                                <div class="flex items-center">
                                    <a href="{{ Storage::url($lhp->file_review_sheet) }}" target="_blank" class="text-blue-600 hover:text-blue-800">
                                        <i class="fas fa-file-pdf mr-2"></i>Lihat File
                                    </a>
                                    <button type="button" wire:click="deleteFile('file_review_sheet')" class="ml-4 text-red-600 hover:text-red-800">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            @else
                                <div class="space-y-2">
                                    <input type="file" wire:model="file_review_sheet" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                                    @error('file_review_sheet') <span class="text-red-500 text-xs">{{ $message }}</span> @enderror
                                    
                                    <div class="upload-progress hidden space-y-1 mt-2" 
                                         x-data="{ 
                                            progress: 0, 
                                            speed: 0, 
                                            timeRemaining: 'Menghitung...', 
                                            uploaded: 0, 
                                            total: 0,
                                            formatFileSize(bytes) {
                                                if (!bytes || bytes === 0) return '0 Bytes';
                                                const k = 1024;
                                                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                                                const i = Math.floor(Math.log(bytes) / Math.log(k));
                                                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                                            }
                                         }" 
                                         x-init="
                                            $watch('progress', value => {
                                                const progressBar = $el.querySelector('.progress-bar');
                                                if (progressBar) {
                                                    progressBar.style.width = value + '%';
                                                    progressBar.classList.toggle('bg-blue-600', value < 100);
                                                    progressBar.classList.toggle('bg-green-500', value === 100);
                                                }
                                            });
                                            
                                            // Listen for progress updates
                                            window.addEventListener('upload-progress-updated', (e) => {
                                                if (e.detail.name === 'file_review_sheet') {
                                                    progress = e.detail.progress;
                                                    const fileInput = $el.closest('dd').querySelector('input[type=file]');
                                                    if (fileInput && fileInput.files[0]) {
                                                        uploaded = fileInput.files[0].size * (progress / 100);
                                                        total = fileInput.files[0].size;
                                                    }
                                                }
                                            });
                                         ">
                                        <div class="flex justify-between text-xs text-gray-600">
                                            <span class="font-medium">Mengunggah...</span>
                                            <span x-text="timeRemaining"></span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
                                            <div class="bg-blue-600 h-2 rounded-full progress-bar transition-all duration-300 ease-in-out" 
                                                 :class="{ 'animate-pulse': progress < 100 }">
                                            </div>
                                        </div>
                                        <div class="flex justify-between text-xs text-gray-500">
                                            <span x-text="formatFileSize(uploaded) + ' / ' + formatFileSize(total)"></span>
                                            <span x-text="(progress || 0).toFixed(1) + '%'"></span>
                                        </div>
                                    </div>
                                </div>
                            @endif
                        </dd>
                    </div>
                    
                    <!-- File Nota Dinas -->
                    <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                        <dt class="text-sm font-medium text-gray-500">File Nota Dinas</dt>
                        <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">
                            @if($lhp->file_nota_dinas)
                                <div class="flex items-center">
                                    <a href="{{ Storage::url($lhp->file_nota_dinas) }}" target="_blank" class="text-blue-600 hover:text-blue-800">
                                        <i class="fas fa-file-pdf mr-2"></i>Lihat File
                                    </a>
                                    <button type="button" wire:click="deleteFile('file_nota_dinas')" class="ml-4 text-red-600 hover:text-red-800">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            @else
                                <div class="space-y-2">
                                    <input type="file" wire:model="file_nota_dinas" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                                    @error('file_nota_dinas') <span class="text-red-500 text-xs">{{ $message }}</span> @enderror
                                    
                                    <div class="upload-progress hidden space-y-1 mt-2" 
                                         x-data="{ 
                                            progress: 0, 
                                            speed: 0, 
                                            timeRemaining: 'Menghitung...', 
                                            uploaded: 0, 
                                            total: 0,
                                            formatFileSize(bytes) {
                                                if (!bytes || bytes === 0) return '0 Bytes';
                                                const k = 1024;
                                                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                                                const i = Math.floor(Math.log(bytes) / Math.log(k));
                                                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                                            }
                                         }" 
                                         x-init="
                                            $watch('progress', value => {
                                                const progressBar = $el.querySelector('.progress-bar');
                                                if (progressBar) {
                                                    progressBar.style.width = value + '%';
                                                    progressBar.classList.toggle('bg-blue-600', value < 100);
                                                    progressBar.classList.toggle('bg-green-500', value === 100);
                                                }
                                            });
                                            
                                            // Listen for progress updates
                                            window.addEventListener('upload-progress-updated', (e) => {
                                                if (e.detail.name === 'file_nota_dinas') {
                                                    progress = e.detail.progress;
                                                    const fileInput = $el.closest('dd').querySelector('input[type=file]');
                                                    if (fileInput && fileInput.files[0]) {
                                                        uploaded = fileInput.files[0].size * (progress / 100);
                                                        total = fileInput.files[0].size;
                                                    }
                                                }
                                            });
                                         ">
                                        <div class="flex justify-between text-xs text-gray-600">
                                            <span class="font-medium">Mengunggah...</span>
                                            <span x-text="timeRemaining"></span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
                                            <div class="bg-blue-600 h-2 rounded-full progress-bar transition-all duration-300 ease-in-out" 
                                                 :class="{ 'animate-pulse': progress < 100 }">
                                            </div>
                                        </div>
                                        <div class="flex justify-between text-xs text-gray-500">
                                            <span x-text="formatFileSize(uploaded) + ' / ' + formatFileSize(total)"></span>
                                            <span x-text="(progress || 0).toFixed(1) + '%'"></span>
                                        </div>
                                    </div>
                                </div>
                            @endif
                        </dd>
                    </div>
                </dl>
            </div>
        </div>

        <!-- Rest of the form remains the same... -->
        <!-- Group 2: Findings -->
        <div class="bg-white shadow overflow-hidden sm:rounded-lg mb-8">
            <div class="px-4 py-5 sm:px-6 bg-gray-50">
                <h3 class="text-lg font-medium leading-6 text-gray-900">Temuan dan Rekomendasi</h3>
                <p class="mt-1 max-w-2xl text-sm text-gray-500">Masukkan temuan dan rekomendasi dari pemeriksaan</p>
            </div>
            <div class="border-t border-gray-200 px-4 py-5 sm:p-0">
                <dl class="sm:divide-y sm:divide-gray-200">
                    <!-- Temuan -->
                    <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                        <dt class="text-sm font-medium text-gray-500">Temuan</dt>
                        <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">
                            <textarea wire:model="temuan" rows="3" class="shadow-sm focus:ring-blue-500 focus:border-blue-500 mt-1 block w-full sm:text-sm border border-gray-300 rounded-md"></textarea>
                            @error('temuan') <span class="text-red-500 text-xs">{{ $message }}</span> @enderror
                        </dd>
                    </div>
                    
                    <!-- Rincian Rekomendasi -->
                    <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                        <dt class="text-sm font-medium text-gray-500">Rincian Rekomendasi</dt>
                        <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">
                            <textarea wire:model="rincian_rekomendasi" rows="3" class="shadow-sm focus:ring-blue-500 focus:border-blue-500 mt-1 block w-full sm:text-sm border border-gray-300 rounded-md"></textarea>
                            @error('rincian_rekomendasi') <span class="text-red-500 text-xs">{{ $message }}</span> @enderror
                        </dd>
                    </div>
                    
                    <!-- Besaran Temuan -->
                    <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                        <dt class="text-sm font-medium text-gray-500">Besaran Temuan</dt>
                        <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">
                            <input type="text" wire:model="besaran_temuan" class="shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md">
                            @error('besaran_temuan') <span class="text-red-500 text-xs">{{ $message }}</span> @enderror
                        </dd>
                    </div>
                    
                    <!-- Tindak Lanjut -->
                    <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                        <dt class="text-sm font-medium text-gray-500">Tindak Lanjut</dt>
                        <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">
                            <textarea wire:model="tindak_lanjut" rows="3" class="shadow-sm focus:ring-blue-500 focus:border-blue-500 mt-1 block w-full sm:text-sm border border-gray-300 rounded-md"></textarea>
                            @error('tindak_lanjut') <span class="text-red-500 text-xs">{{ $message }}</span> @enderror
                        </dd>
                    </div>
                </dl>
            </div>
        </div>

        <div class="flex justify-end">
            <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                Simpan Perubahan
            </button>
        </div>
    </form>

    <!-- Tindak Lanjut Section -->
    <div class="mt-10">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-gray-900">Tindak Lanjut</h2>
            <button wire:click="openTindakLanjutModal" class="inline-flex items-center px-4 py-2 bg-blue-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-blue-700 focus:bg-blue-700 active:bg-blue-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition ease-in-out duration-150">
                <i class="fas fa-plus mr-2"></i> Tambah Tindak Lanjut
            </button>
        </div>

        @if($lhp->tindakLanjuts->count() > 0)
            <div class="bg-white shadow overflow-hidden sm:rounded-lg">
                <ul class="divide-y divide-gray-200">
                    @foreach($lhp->tindakLanjuts as $tindakLanjut)
                        <li class="p-4 hover:bg-gray-50">
                            <div class="flex items-start">
                                <!-- File Icon -->
                                <div class="flex-shrink-0 h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center">
                                    @if($tindakLanjut->file_type === 'pdf')
                                        <i class="fas fa-file-pdf text-red-500"></i>
                                    @elseif(in_array($tindakLanjut->file_type, ['jpg', 'jpeg', 'png', 'gif']))
                                        <i class="fas fa-file-image text-green-500"></i>
                                    @elseif(in_array($tindakLanjut->file_type, ['doc', 'docx']))
                                        <i class="fas fa-file-word text-blue-500"></i>
                                    @elseif(in_array($tindakLanjut->file_type, ['xls', 'xlsx']))
                                        <i class="fas fa-file-excel text-green-600"></i>
                                    @elseif(in_array($tindakLanjut->file_type, ['mp3', 'wav', 'ogg']))
                                        <i class="fas fa-file-audio text-purple-500"></i>
                                    @elseif(in_array($tindakLanjut->file_type, ['mp4', 'mov', 'avi']))
                                        <i class="fas fa-file-video text-yellow-500"></i>
                                    @else
                                        <i class="fas fa-file text-gray-400"></i>
                                    @endif
                                </div>
                                
                                <!-- File Info -->
                                <div class="ml-4 flex-1 min-w-0">
                                    <div class="flex justify-between">
                                        <p class="text-sm font-medium text-gray-900 truncate">
                                            {{ $tindakLanjut->file_name }}
                                        </p>
                                        <div class="flex space-x-2">
                                            <button wire:click="downloadTindakLanjut({{ $tindakLanjut->id }})" class="text-blue-600 hover:text-blue-800" title="Unduh">
                                                <i class="fas fa-download"></i>
                                            </button>
                                            <button wire:click="openTindakLanjutModal({{ $tindakLanjut->id }})" class="text-yellow-600 hover:text-yellow-800" title="Edit">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button onclick="confirm('Apakah Anda yakin ingin menghapus tindak lanjut ini?') || event.stopImmediatePropagation()" wire:click="deleteTindakLanjut({{ $tindakLanjut->id }})" class="text-red-600 hover:text-red-800" title="Hapus">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    @if($tindakLanjut->description)
                                        <p class="mt-1 text-sm text-gray-600">{{ $tindakLanjut->description }}</p>
                                    @endif
                                    
                                    <div class="mt-1 text-xs text-gray-500">
                                        {{ $tindakLanjut->formatted_size }} • 
                                        {{ $tindakLanjut->created_at->format('d M Y H:i') }}
                                    </div>
                                    
                                    <!-- File Preview -->
                                    @if($tindakLanjut->isImage())
                                        <div class="mt-2">
                                            <img src="{{ $tindakLanjut->file_url }}" alt="Preview" class="h-40 w-auto rounded border border-gray-200">
                                        </div>
                                    @elseif($tindakLanjut->isPdf())
                                        <div class="mt-2">
                                            <iframe src="{{ $tindakLanjut->file_url }}" class="w-full h-80 border border-gray-200 rounded" frameborder="0"></iframe>
                                        </div>
                                    @endif
                                </div>
                            </div>
                        </li>
                    @endforeach
                </ul>
            </div>
        @else
            <div class="bg-white shadow overflow-hidden sm:rounded-lg p-6 text-center">
                <i class="fas fa-inbox text-gray-400 text-4xl mb-2"></i>
                <p class="text-gray-500">Belum ada data tindak lanjut.</p>
                <p class="text-sm text-gray-400 mt-1">Klik tombol "Tambah Tindak Lanjut" untuk menambahkan.</p>
            </div>
        @endif
    </div>
    
    <!-- Tindak Lanjut Modal -->
    <x-dialog-modal wire:model="showTindakLanjutModal">
        <x-slot name="title">
            {{ $tindakLanjutId ? 'Edit Tindak Lanjut' : 'Tambah Tindak Lanjut' }}
        </x-slot>
        
        <x-slot name="content">
            <div class="space-y-4">
                <!-- File Upload -->
                <div>
                    <x-label for="tindakLanjutFile" value="File" />
                    <div class="mt-1">
                        <input type="file" id="tindakLanjutFile" wire:model="tindakLanjutFile" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                        @error('tindakLanjutFile') <span class="text-red-500 text-xs">{{ $message }}</span> @enderror
                    </div>
                    
                    @if($tindakLanjutFilePreview || ($tindakLanjutId && $tindakLanjutFileName))
                        <div class="mt-2">
                            <p class="text-sm text-gray-600">File: {{ $tindakLanjutFileName }}</p>
                            @if($tindakLanjutFilePreview)
                                @if(Str::startsWith($tindakLanjutFile->getMimeType(), 'image/'))
                                    <img src="{{ $tindakLanjutFilePreview }}" class="h-40 w-auto mt-2 rounded border border-gray-200">
                                @elseif($tindakLanjutFile->getMimeType() === 'application/pdf')
                                    <div class="mt-2 p-2 bg-gray-50 rounded border border-gray-200">
                                        <i class="fas fa-file-pdf text-red-500 mr-2"></i>
                                        <span class="text-sm text-gray-600">PDF Preview</span>
                                    </div>
                                @endif
                            @endif
                        </div>
                    @endif
                </div>
                
                <!-- Description -->
                <div>
                    <x-label for="tindakLanjutDescription" value="Keterangan (Opsional)" />
                    <textarea id="tindakLanjutDescription" wire:model.defer="tindakLanjutDescription" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"></textarea>
                    @error('tindakLanjutDescription') <span class="text-red-500 text-xs">{{ $message }}</span> @enderror
                </div>
            </div>
        </x-slot>
        
        <x-slot name="footer">
            <x-secondary-button wire:click="closeTindakLanjutModal" class="mr-2">
                Batal
            </x-secondary-button>
            <x-button wire:click="saveTindakLanjut" wire:loading.attr="disabled">
                <i class="fas fa-save mr-2"></i> Simpan
            </x-button>
        </x-slot>
    </x-dialog-modal>
</div>

@push('styles')
<style>
    .progress-bar {
        transition: width 0.3s ease-in-out;
    }
    .animate-pulse-slow {
        animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }
    /* SweetAlert2 Customizations */
    .swal2-popup {
        font-size: 0.9rem !important;
    }
    .swal2-title {
        font-size: 1.2rem !important;
    }
</style>
@endpush

@push('scripts')
<!-- SweetAlert2 JS -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.addEventListener('livewire:initialized', () => {
        // Get the LHP ID from the Livewire component
        const lhpId = @json($lhp->id);
        
        // Handle file input changes - escape the colon in wire:model
        document.querySelectorAll('input[type="file"][wire\\:model]').forEach(input => {
            input.addEventListener('change', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const fieldName = this.getAttribute('wire:model');
                const file = this.files[0];
                const fileInput = this; // Store reference to the input
                
                if (!file) return;
                
                // Validate file type
                const validTypes = ['application/pdf'];
                if (!validTypes.includes(file.type)) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Format File Tidak Valid',
                        text: 'Hanya file PDF yang diizinkan.',
                        confirmButtonText: 'Mengerti'
                    });
                    this.value = ''; // Clear the file input
                    return;
                }
                
                // Validate file size (200MB)
                const maxSize = 200 * 1024 * 1024; // 200MB in bytes
                if (file.size > maxSize) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Ukuran File Terlalu Besar',
                        text: 'Ukuran file melebihi batas maksimal 200MB.',
                        confirmButtonText: 'Mengerti'
                    });
                    this.value = ''; // Clear the file input
                    return;
                }
                
                // Create a fresh FormData instance
                const formData = new FormData();
                
                // Append the file with the correct field name
                formData.append('file', file);
                formData.append('field_name', fieldName);
                formData.append('lhp_id', lhpId); // Add the LHP ID
                
                // Log file info for debugging
                console.log('File to upload:', {
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    lastModified: file.lastModified,
                    lhpId: lhpId
                });
                
                // Show progress container
                const progressContainer = this.closest('dd').querySelector('.upload-progress');
                if (progressContainer) {
                    progressContainer.classList.remove('hidden');
                    // Clear any previous errors
                    const errorElement = progressContainer.querySelector('.text-red-500');
                    if (errorElement) errorElement.textContent = '';
                }
                
                // Create a new XMLHttpRequest
                const xhr = new XMLHttpRequest();
                
                // Configure the request
                const uploadUrl = '{{ route('livewire.upload-file') }}';
                console.log('Upload URL:', uploadUrl); // Debug log
                xhr.open('POST', uploadUrl, true);
                
                // Set CSRF token
                const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
                xhr.setRequestHeader('X-CSRF-TOKEN', csrfToken);
                xhr.setRequestHeader('Accept', 'application/json');
                xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
                
                // Handle upload progress
                xhr.upload.onprogress = (e) => {
                    if (e.lengthComputable) {
                        const percentComplete = Math.round((e.loaded / e.total) * 100);
                        console.log(`Upload progress: ${percentComplete}%`);
                        
                        // Dispatch progress event for Alpine.js
                        window.dispatchEvent(new CustomEvent('upload-progress-updated', {
                            detail: {
                                name: fieldName,
                                progress: percentComplete
                            }
                        }));
                        
                        // Update Livewire component with progress
                        @this.updateUploadProgress(
                            fieldName, 
                            percentComplete,
                            e.loaded,
                            e.total
                        );
                    }
                };
                
                // Handle successful upload
                xhr.onload = () => {
                    console.log('Upload complete. Status:', xhr.status);
                    
                    if (xhr.status === 200) {
                        try {
                            const response = JSON.parse(xhr.responseText);
                            if (response.success) {
                                // Hide progress container after successful upload
                                if (progressContainer) {
                                    setTimeout(() => {
                                        progressContainer.classList.add('hidden');
                                    }, 1000);
                                }
                                
                                // Reset the input to allow re-uploading the same file
                                fileInput.value = '';
                                
                                // Refresh the Livewire component to show the uploaded file
                                @this.refresh();
                                
                                // Show success message with SweetAlert2
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Berhasil!',
                                    text: 'File berhasil diunggah',
                                    toast: true,
                                    position: 'top-end',
                                    showConfirmButton: false,
                                    timer: 3000,
                                    timerProgressBar: true,
                                    didOpen: (toast) => {
                                        toast.addEventListener('mouseenter', Swal.stopTimer);
                                        toast.addEventListener('mouseleave', Swal.resumeTimer);
                                    }
                                });
                            } else {
                                showUploadError(progressContainer, response.message || 'Upload gagal');
                            }
                        } catch (e) {
                            console.error('Error parsing upload response:', e);
                            showUploadError(progressContainer, 'Terjadi kesalahan saat memproses respons');
                        }
                    } else {
                        let errorMessage = `Server error: ${xhr.status} ${xhr.statusText}`;
                        try {
                            const response = JSON.parse(xhr.responseText);
                            errorMessage = response.message || errorMessage;
                        } catch (e) {}
                        showUploadError(progressContainer, errorMessage);
                    }
                };
                
                // Handle upload errors
                xhr.onerror = () => {
                    console.error('Upload error occurred');
                    showUploadError(progressContainer, 'Kesalahan koneksi saat mengunggah file');
                };
                
                // Handle timeout
                xhr.ontimeout = () => {
                    console.error('Upload timed out');
                    showUploadError(progressContainer, 'Waktu unggah habis. Silakan coba lagi.');
                };
                
                // Set timeout (5 minutes)
                xhr.timeout = 5 * 60 * 1000;
                
                // Function to show upload errors
                function showUploadError(container, message) {
                    console.error('Upload error:', message);
                    // Show SweetAlert2 error
                    Swal.fire({
                        icon: 'error',
                        title: 'Upload Gagal',
                        text: message,
                        toast: true,
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 5000,
                        timerProgressBar: true,
                        didOpen: (toast) => {
                            toast.addEventListener('mouseenter', Swal.stopTimer);
                            toast.addEventListener('mouseleave', Swal.resumeTimer);
                        }
                    });
                }
                
                // Show loading notification with SweetAlert2
                let timerInterval;
                Swal.fire({
                    title: 'Mengunggah File',
                    html: `Sedang mengunggah <b>${file.name}</b>...`, 
                    timerProgressBar: true,
                    didOpen: () => {
                        Swal.showLoading();
                        const b = Swal.getHtmlContainer().querySelector('b');
                        timerInterval = setInterval(() => {
                            const progress = document.querySelector(`#progress-${fieldName} .progress-bar`);
                            if (progress) {
                                const percent = progress.style.width || '0%';
                                b.textContent = `Mengunggah ${percent}`;
                            }
                        }, 100);
                    },
                    willClose: () => {
                        clearInterval(timerInterval);
                    }
                });
                
                // Start the upload
                xhr.send(formData);
            });
        });
    });
</script>
@endpush